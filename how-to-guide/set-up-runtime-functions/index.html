<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>How to Set up Run-time Functions · FLOWUnsteady</title><link href="https://fonts.googleapis.com/css?family=Lato|Roboto+Mono" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.11.1/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../../"><img src="../../assets/logo.png" alt="FLOWUnsteady logo"/></a><div class="docs-package-name"><span class="docs-autofit">FLOWUnsteady</span></div><form class="docs-search" action="../../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../../">Home</a></li><li><span class="tocitem">Tutorials</span><ul><li><a class="tocitem" href="../../tutorials/getting-started/">Getting Started</a></li><li><a class="tocitem" href="../../tutorials/first-steps/">First Steps</a></li></ul></li><li><span class="tocitem">How to </span><ul><li><a class="tocitem" href="../paraview-visualization/">Visualize with Paraview</a></li><li><a class="tocitem" href="../define-complex-wings/">How to define Complex Wings</a></li><li><a class="tocitem" href="../define-complex-systems/">How to Define Vehicle Systems</a></li><li><a class="tocitem" href="../define-a-rotor/">How to Define a Custom Rotor</a></li><li><a class="tocitem" href="../define-kinematic-maneuvers/">How to Define Kinematic Maneuvers</a></li><li class="is-active"><a class="tocitem" href>How to Set up Run-time Functions</a><ul class="internal"><li><a class="tocitem" href="#Creating-Monitors-1"><span>Creating Monitors</span></a></li><li><a class="tocitem" href="#Calculating-Aerodynamic-Forces-1"><span>Calculating Aerodynamic Forces</span></a></li><li><a class="tocitem" href="#Adding-data-to-output-files-1"><span>Adding data to output files</span></a></li></ul></li><li><a class="tocitem" href="../select-a-solver/">Select a Solver</a></li><li><a class="tocitem" href="../wake-stability/">How to Approach Wake Stability Issues</a></li></ul></li><li><span class="tocitem">Reference</span><ul><li><a class="tocitem" href="../../reference/FLOWVLMfunctions/">Functions Contained in FLOWVLM</a></li><li><a class="tocitem" href="../../reference/VPMfunctions/">Functions Contained in MyVPM</a></li><li><a class="tocitem" href="../../reference/FLOWUnsteadyfunctions/">Functions Contained in FLOWUnsteady</a></li></ul></li><li><span class="tocitem">Theory</span><ul><li><a class="tocitem" href="../../theory/FLOWVLMtheory/">FLOWVLM</a></li><li><a class="tocitem" href="../../theory/VPMtheory/">Vortex Particle Method</a></li><li><a class="tocitem" href="../../theory/FLOWUnsteadytheory/">FLOWUnsteady</a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">How to </a></li><li class="is-active"><a href>How to Set up Run-time Functions</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>How to Set up Run-time Functions</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/byuflowlab/FLOWUnsteady/blob/master/docs/src/how-to-guide/set-up-runtime-functions.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="How-to-Set-up-Run-time-Functions-1"><a class="docs-heading-anchor" href="#How-to-Set-up-Run-time-Functions-1">How to Set up Run-time Functions</a><a class="docs-heading-anchor-permalink" href="#How-to-Set-up-Run-time-Functions-1" title="Permalink"></a></h1><p>FLOWUnsteady allows for the definition of additional run-time functions, which are passed into the keyword argument, <code>extra_runtime_function</code>, in the <code>run_simulation()</code> function.</p><p>These are typically formatted as follows:</p><pre><code class="language-julia">function customfunction(inputs)

    function extra_runtime_function(sim, pfield, t, dt)

        #insert your function here

        return false

    end

end</code></pre><p>If you have more than one additional function you&#39;d like to run, a nice way for allowing arbitrarily defined functions is to define an encapsulating functions with the <code>args...</code> command such as</p><pre><code class="language-julia">customfunc1 = customfunction1(inputs1)
customfunc2 = customfunction2(inputs2)
extrafunctions(args...) = customfunc1(args...) || customfunc2(args...)</code></pre><h2 id="Creating-Monitors-1"><a class="docs-heading-anchor" href="#Creating-Monitors-1">Creating Monitors</a><a class="docs-heading-anchor-permalink" href="#Creating-Monitors-1" title="Permalink"></a></h2><p>By incorporating plots into an extra runtime function, you can create monitors that will show you the progress of the simulation.  The definition of these very much depends on your use case. For the creators, aerodynamic forces are important, so we&#39;ll cover that now.</p><h2 id="Calculating-Aerodynamic-Forces-1"><a class="docs-heading-anchor" href="#Calculating-Aerodynamic-Forces-1">Calculating Aerodynamic Forces</a><a class="docs-heading-anchor-permalink" href="#Calculating-Aerodynamic-Forces-1" title="Permalink"></a></h2><p>FLOWUnsteady has some functions that assist in calculating aerodynamic forces.  Specifically, the <code>calc_aerodynamicforces()</code> function and the <code>decompose()</code> function.</p><p>To get the total forces on a wing object, you need the current and previous wing state, as well as the freestream velocity and density.</p><pre><code class="language-julia">Ftot = uns.calc_aerodynamicforces(currentwingobject,priorstepwingobject, pfield, Vinf, dt, rhoinf)</code></pre><div class="admonition is-info"><header class="admonition-header">Previous Wing</header><div class="admonition-body"><p>In order to save the previous wing, it is convenient to initialize prev<em>wing to nothing before entering the extra</em>runtime function, and using deep copy at the end of the extra runtime function (before returning <code>false</code>).</p><pre><code class="language-none">function customfunc(inputs)

    prev_wing = nothing

    extra_runtime_function(sim,pfield,t,dt)

        #custom function

        prev_wing = deepcopy(wing)

        return false

    end

end</code></pre></div></div><p>This gives you the total forces on the overall wing. If you want the forces on each section of the wing, you&#39;d have to set the <code>per_unit_span</code> boolean keyword argument to <code>true</code></p><pre><code class="language-julia">ftot = uns.calc_aerodynamicforces(currentwingobject,priorstepwingobject, pfield, Vinf, dt, rhoinf; per_unit_span=true)</code></pre><p>To get the respective Lift, Drag, and Sideslip forces, you need to pass the total force vector into the <code>decompose()</code> function along with two orthogonal vectors indicating what direction the forces are acting.</p><p>For example, for steady, level flight in the typical aerodynamics frame, you could do</p><pre><code class="language-julia">L, D, S = uns.decompose(Ftot,[0,0,1],[1,0,0])</code></pre><p>Where lift is in the positive z-direction, or <code>[0,0,1]</code> and drag is in the positive x-direction, or <code>[1,0,0]</code>.  The decompose function only needs the directions for the first two outputs, and then it calculates the third vector.</p><div class="admonition is-info"><header class="admonition-header">Arbitrary Force Vectors</header><div class="admonition-body"><p>Because of how the decompose function is defined, you have no limits on what forces you calculate. That is to say, you can find the forces in any reference frame.  This also makes the user responsible for defining exactly what they want to use as the Lift vector, etc.</p></div></div><h2 id="Adding-data-to-output-files-1"><a class="docs-heading-anchor" href="#Adding-data-to-output-files-1">Adding data to output files</a><a class="docs-heading-anchor-permalink" href="#Adding-data-to-output-files-1" title="Permalink"></a></h2><p>By passing, say, a wing object into an extra runtime function, you can use the <code>_addsolution()</code> function in the VLM module to add data to the .vtk files output by the simulation.  This way, you can visualize in Paraview things such as forces and velocities in addition to the default outputs.</p><p>For example, if you had calculated Lift and Drag, and wanted to include those in the files used in Paraview visualization you could run the commands</p><pre><code class="language-julia">vlm._addsolution(wingobject,&quot;Lift&quot;,Lift)
vlm._addsolution(wingobject,&quot;Drag&quot;,Drag)</code></pre><p>You can also write data to other files that you define yourself.  For example, if you wanted to save the lift and drag coefficients in a .csv file for easy plotting later, you would simply open a file, write to it, and close it as one would normally do.</p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../define-kinematic-maneuvers/">« How to Define Kinematic Maneuvers</a><a class="docs-footer-nextpage" href="../select-a-solver/">Select a Solver »</a></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> on <span class="colophon-date" title="Friday 12 June 2020 12:26">Friday 12 June 2020</span>. Using Julia version 1.3.0.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
