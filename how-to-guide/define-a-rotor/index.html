<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>How to Define a Custom Rotor · FLOWUnsteady</title><link href="https://fonts.googleapis.com/css?family=Lato|Roboto+Mono" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.11.1/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../../"><img src="../../assets/logo.png" alt="FLOWUnsteady logo"/></a><div class="docs-package-name"><span class="docs-autofit">FLOWUnsteady</span></div><form class="docs-search" action="../../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../../">Home</a></li><li><span class="tocitem">Tutorials</span><ul><li><a class="tocitem" href="../../tutorials/getting-started/">Getting Started</a></li><li><a class="tocitem" href="../../tutorials/first-steps/">First Steps</a></li></ul></li><li><span class="tocitem">How to </span><ul><li><a class="tocitem" href="../paraview-visualization/">Visualize with Paraview</a></li><li><a class="tocitem" href="../define-complex-wings/">How to define Complex Wings</a></li><li><a class="tocitem" href="../define-complex-systems/">How to Define Vehicle Systems</a></li><li class="is-active"><a class="tocitem" href>How to Define a Custom Rotor</a><ul class="internal"><li><a class="tocitem" href="#Parameters-1"><span>Parameters</span></a></li><li><a class="tocitem" href="#Simulation-Setup-1"><span>Simulation Setup</span></a></li><li><a class="tocitem" href="#Run-Simulation-1"><span>Run Simulation</span></a></li><li><a class="tocitem" href="#Adding-a-Custom-Rotor-1"><span>Adding a Custom Rotor</span></a></li></ul></li><li><a class="tocitem" href="../define-kinematic-maneuvers/">How to Define Kinematic Maneuvers</a></li><li><a class="tocitem" href="../set-up-runtime-functions/">How to Set up Run-time Functions</a></li><li><a class="tocitem" href="../select-a-solver/">Select a Solver</a></li><li><a class="tocitem" href="../calculate-aerodynamic-forces/">How to Calculate Aerodynamic Forces</a></li><li><a class="tocitem" href="../wake-stability/">How to Approach Wake Stability Issues</a></li></ul></li><li><span class="tocitem">Reference</span><ul><li><a class="tocitem" href="../../reference/FLOWVLMfunctions/">Functions Contained in FLOWVLM</a></li><li><a class="tocitem" href="../../reference/VPMfunctions/">Functions Contained in MyVPM</a></li><li><a class="tocitem" href="../../reference/FLOWUnsteadyfunctions/">Functions Contained in FLOWUnsteady</a></li></ul></li><li><span class="tocitem">Theory</span><ul><li><a class="tocitem" href="../../theory/FLOWVLMtheory/">FLOWVLM</a></li><li><a class="tocitem" href="../../theory/VPMtheory/">Vortex Particle Method</a></li><li><a class="tocitem" href="../../theory/FLOWUnsteadytheory/">FLOWUnsteady</a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">How to </a></li><li class="is-active"><a href>How to Define a Custom Rotor</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>How to Define a Custom Rotor</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/byuflowlab/FLOWUnsteady/blob/master/docs/src/how-to-guide/define-a-rotor.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="How-to-Define-a-Custom-Rotor-1"><a class="docs-heading-anchor" href="#How-to-Define-a-Custom-Rotor-1">How to Define a Custom Rotor</a><a class="docs-heading-anchor-permalink" href="#How-to-Define-a-Custom-Rotor-1" title="Permalink"></a></h1><p>If you&#39;d like to simulate any type of rotor, say a propeller, fan or turbine, you define your parameters, setup the simulation and then run the simulation. As with previous tasks, here we go through each step, but adding two rotors to the hershey bar wing.</p><h2 id="Parameters-1"><a class="docs-heading-anchor" href="#Parameters-1">Parameters</a><a class="docs-heading-anchor-permalink" href="#Parameters-1" title="Permalink"></a></h2><p>First you will need to define all of the parameters that dictate the geometry and aerodynamic qualities of your rotor. Most of the information that defines your rotor is included in a database. FlowUnsteady includes a modest database of rotors including propellers and turbine blades. If you need a rotor outside of the database, see below on how to add a custom rotor.</p><h5 id="Initialize-FlowUnsteady-and-define-the-rotor-file-and-I/O-1"><a class="docs-heading-anchor" href="#Initialize-FlowUnsteady-and-define-the-rotor-file-and-I/O-1">Initialize FlowUnsteady and define the rotor file and I/O</a><a class="docs-heading-anchor-permalink" href="#Initialize-FlowUnsteady-and-define-the-rotor-file-and-I/O-1" title="Permalink"></a></h5><pre><code class="language-julia">import FLOWUnsteady
uns = FLOWUnsteady
vlm = uns.vlm

import GeometricTools
gt = GeometricTools


# ------ PARAMETERS ---------
# Rotor Geometry
rotor_file = &quot;DJI-II.csv&quot; 						#Rotor Geometry
data_path = uns.def_data_path 				#Path to rotor database
run_name = &quot;singlerotor&quot;</code></pre><h5 id="Define-rotor-parameters-1"><a class="docs-heading-anchor" href="#Define-rotor-parameters-1">Define rotor parameters</a><a class="docs-heading-anchor-permalink" href="#Define-rotor-parameters-1" title="Permalink"></a></h5><p><em>Note that the parameters must match what is given in the rotor definition files, otherwise the simulation will fail or provide incorrect results.</em></p><pre><code class="language-julia">pitch = 0.0 						#(deg) collective blade pitch
n			= 10 							# Number of blade elements
CW 		= false 					# Clock-wise rotation</code></pre><p><em>Some rotor geometry values can be read directly from the rotor file, preventing some error due to mismatched data.</em></p><pre><code class="language-julia">R, B = uns.read_rotor(rotor_file; data_path=data_path)[[1,3]]</code></pre><h5 id="Define-simulation-parameters-according-to-your-situation-1"><a class="docs-heading-anchor" href="#Define-simulation-parameters-according-to-your-situation-1">Define simulation parameters according to your situation</a><a class="docs-heading-anchor-permalink" href="#Define-simulation-parameters-according-to-your-situation-1" title="Permalink"></a></h5><pre><code class="language-julia">RPM = 5000                          # RPM
J   = 0.0                           # Advance ratio Vinf/(nD)
rho = 1.225                         # (kg/m^3) air density
mu  = 1.81e-5                       # (kg/ms) air dynamic viscosity
ReD = 2*pi*RPM/60*R * rho/mu * 2*R  # Tip-based Reynolds number</code></pre><h5 id="Define-a-function-that-describes-freestream-velocity-1"><a class="docs-heading-anchor" href="#Define-a-function-that-describes-freestream-velocity-1">Define a function that describes freestream velocity</a><a class="docs-heading-anchor-permalink" href="#Define-a-function-that-describes-freestream-velocity-1" title="Permalink"></a></h5><pre><code class="language-julia">Vinf(x,t) = [20, 0, 0] 							#(m/s) freestream velocity [soley x direction]</code></pre><p><em>Note that this function can describe the free stream dependent on distance or time, here we simply declare a constant freestream velocity.</em></p><h5 id="Define-the-solver-parameters-1"><a class="docs-heading-anchor" href="#Define-the-solver-parameters-1">Define the solver parameters</a><a class="docs-heading-anchor-permalink" href="#Define-the-solver-parameters-1" title="Permalink"></a></h5><pre><code class="language-julia"># Solver parameters
nrevs = 6                           # Number of revolutions in simulation
nsteps_per_rev = 72                 # Time steps per revolution
p_per_step = 2                      # Sheds per time step
ttot = nrevs/(RPM/60)               # (s) total simulation time
nsteps = nrevs*nsteps_per_rev       # Number of time steps
lambda = 2.125                      # Core overlap
overwrite_sigma = lambda * 2*pi*R/(nsteps_per_rev*p_per_step) # Smoothing core size
surf_sigma = R/10                   # Smoothing radius of lifting surface
vlm_sigma = surf_sigma              # Smoothing radius of VLM
shed_unsteady = true                # Shed particles from unsteady loading

max_particles = ((2*n+1)*B)*nrevs*nsteps_per_rev*p_per_step # Max particles for memory pre-allocation
plot_disc = true                    # Plot blade discretization for debugging

xfoil = true 												# Generate airfoil polars for BEM
verbose = true 											# Echo status periodically</code></pre><h2 id="Simulation-Setup-1"><a class="docs-heading-anchor" href="#Simulation-Setup-1">Simulation Setup</a><a class="docs-heading-anchor-permalink" href="#Simulation-Setup-1" title="Permalink"></a></h2><h5 id="Now-using-all-of-the-parameters-previously-defined,-generate-the-rotor-system-1"><a class="docs-heading-anchor" href="#Now-using-all-of-the-parameters-previously-defined,-generate-the-rotor-system-1">Now using all of the parameters previously defined, generate the rotor system</a><a class="docs-heading-anchor-permalink" href="#Now-using-all-of-the-parameters-previously-defined,-generate-the-rotor-system-1" title="Permalink"></a></h5><p><em>Every object must be added to a wing system, so here we create an empty wing system and add the rotor. Objects included in the wing system will not explicitly be included in the solution, but will be included in visualization.</em></p><pre><code class="language-julia"># ------------ SIMULATION SETUP --------------------------------------------
# Generate rotor
rotor = uns.generate_rotor(rotor_file; pitch=pitch,
                                            n=n, CW=CW, ReD=ReD,
                                            verbose=verbose, xfoil=xfoil,
                                            data_path=data_path,
                                            plot_disc=plot_disc)
# Systems of rotors
rotors = vlm.Rotor[rotor]   # Defining this rotor as its own system
rotor_systems = (rotors,)

# ----- VEHICLE DEFINITION
# System of all FLOWVLM objects
system = vlm.WingSystem()
vlm.addwing(system, run_name, rotor)
</code></pre><h5 id="Create-a-wake_system.-1"><a class="docs-heading-anchor" href="#Create-a-wake_system.-1">Create a wake_system.</a><a class="docs-heading-anchor-permalink" href="#Create-a-wake_system.-1" title="Permalink"></a></h5><p><em>Any object that sheds a wake must be added to the wake_system.</em></p><pre><code class="language-julia"># Wake-shedding system (doesn&#39;t include the rotor if quasi-steady vehicle)
wake_system = vlm.WingSystem()

if VehicleType != uns.QVLMVehicle
    vlm.addwing(wake_system, run_name, rotor)
else
   # Mute colinear warnings. This is needed since the quasi-steady solver
   #   will probe induced velocities at the lifting line of the blade
    uns.vlm.VLMSolver._mute_warning(true)
end</code></pre><h5 id="Generate-a-vehicle-object-out-of-the-rotor-system-and-wake.-1"><a class="docs-heading-anchor" href="#Generate-a-vehicle-object-out-of-the-rotor-system-and-wake.-1">Generate a vehicle object out of the rotor system and wake.</a><a class="docs-heading-anchor-permalink" href="#Generate-a-vehicle-object-out-of-the-rotor-system-and-wake.-1" title="Permalink"></a></h5><p><em>If you were generating other bodies such as wings, an aircraft body or a turbine tower, you would first create those and generate the vehicle object with those included.</em></p><pre><code class="language-julia"># FVS&#39;s Vehicle object
vehicle = VehicleType(   system;
                            rotor_systems=rotor_systems,
                            wake_system=wake_system
                         )</code></pre><h5 id="Generate-maneuver-definition.-1"><a class="docs-heading-anchor" href="#Generate-maneuver-definition.-1">Generate maneuver definition.</a><a class="docs-heading-anchor-permalink" href="#Generate-maneuver-definition.-1" title="Permalink"></a></h5><p><em>The simulation needs a maneuver, which is covered in a different guide. Here we simply create a maneuver that will keep the rotor at a constant RPM, not tilt, or translate.</em></p><pre><code class="language-julia">    # ----- MANEUVER DEFINITION
    RPM_fun(t) = 1.0                # RPM (normalized by reference RPM) as a
                                    # function of normalized time

    angle = ()                      # Angle of each tilting system (none in this case)
    sysRPM = (RPM_fun, )              # RPM of each rotor system
    Vvehicle(t) = zeros(3)          # Translational velocity of vehicle over Vcruise
    anglevehicle(t) = zeros(3)      # (deg) angle of the vehicle

    # FVS&#39;s Maneuver object
    maneuver = uns.KinematicManeuver(angle, sysRPM, Vvehicle, anglevehicle)</code></pre><h5 id="Create-a-simulation-object-for-the-simulator-to-run.-1"><a class="docs-heading-anchor" href="#Create-a-simulation-object-for-the-simulator-to-run.-1">Create a simulation object for the simulator to run.</a><a class="docs-heading-anchor-permalink" href="#Create-a-simulation-object-for-the-simulator-to-run.-1" title="Permalink"></a></h5><pre><code class="language-julia">    # ----- SIMULATION DEFINITION
    RPMref = RPM
    Vref = 0.0
    simulation = uns.Simulation(vehicle, maneuver, Vref, RPMref, ttot)</code></pre><h2 id="Run-Simulation-1"><a class="docs-heading-anchor" href="#Run-Simulation-1">Run Simulation</a><a class="docs-heading-anchor-permalink" href="#Run-Simulation-1" title="Permalink"></a></h2><h5 id="Call-the-simulation-function-on-the-parameters-and-options-you&#39;ve-defined.-1"><a class="docs-heading-anchor" href="#Call-the-simulation-function-on-the-parameters-and-options-you&#39;ve-defined.-1">Call the simulation function on the parameters and options you&#39;ve defined.</a><a class="docs-heading-anchor-permalink" href="#Call-the-simulation-function-on-the-parameters-and-options-you&#39;ve-defined.-1" title="Permalink"></a></h5><pre><code class="language-julia">    # ------------ RUN SIMULATION ----------------------------------------------
    pfield = uns.run_simulation(simulation, nsteps;
                                      # SIMULATION OPTIONS
                                      Vinf=Vinf,
                                      # SOLVERS OPTIONS
                                      p_per_step=p_per_step,
                                      overwrite_sigma=overwrite_sigma,
                                      vlm_sigma=vlm_sigma,
                                      surf_sigma=surf_sigma,
                                      max_particles=max_particles,
                                      shed_unsteady=shed_unsteady,
                                      # OUTPUT OPTIONS
                                      save_path=nothing,
                                      run_name=run_name,
                                      prompt=true,
                                      verbose=true,
  																		v_lvl=0,
                                      )</code></pre><p>After visualization, you should get a result similar to this.</p><p><img src="../../assets/howtofigs/fvs_singlerotor02.gif" alt="fvs_singlerotor02"/></p><h2 id="Adding-a-Custom-Rotor-1"><a class="docs-heading-anchor" href="#Adding-a-Custom-Rotor-1">Adding a Custom Rotor</a><a class="docs-heading-anchor-permalink" href="#Adding-a-Custom-Rotor-1" title="Permalink"></a></h2><p>It is likely that the rotors defined in the repository database do not match your needs, in that case, you will need to provide all of the information to define the rotor in a series of files. The files must be defined in the correct format and directory structure for FlowUnsteady to find it all. If you are unfamiliar with creating file trees, I suggest adding your files directly to the correct directories, however a seperate file structure can easily be used.</p><ol><li>Create your <a href="how-to-guide/@ref createcustromrotor">custom rotor files</a></li><li>Add them to the correct <a href="../../theory/FLOWUnsteadytheory/#rotordatabasestructure-1">directories</a></li></ol><h4 id="If-using-a-custom-database...-1"><a class="docs-heading-anchor" href="#If-using-a-custom-database...-1">If using a custom database...</a><a class="docs-heading-anchor-permalink" href="#If-using-a-custom-database...-1" title="Permalink"></a></h4><ol><li><p>Create the data structure shown below.</p></li><li><p>Complete the steps above.</p></li><li><p>When initializing the data path (step 1 of defining a rotor), set the data path to the address of the &quot;data&quot; directory</p></li></ol><p>&lt;img src=&quot;../assets/howtofigs/directories1.png&quot; alt=&quot;directories&quot; style=&quot;zoom:60%;&quot; /&gt;</p><p>The database can be found as a subdirectory of the FlowUnsteady package.</p><pre><code class="language-shell">../FlowUnsteady/data</code></pre></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../define-complex-systems/">« How to Define Vehicle Systems</a><a class="docs-footer-nextpage" href="../define-kinematic-maneuvers/">How to Define Kinematic Maneuvers »</a></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> on <span class="colophon-date" title="Thursday 11 June 2020 16:00">Thursday 11 June 2020</span>. Using Julia version 1.3.0.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
